#!/usr/bin/env ruby

require 'octodown'
require 'optparse'
require 'launchy'

include Octodown

# Default options
options = {
  presenter: :html,
  style: :github
}

OptionParser.new do |opts|
  opts.banner = 'Usage: octodown [options]'

  opts.on_tail('--version', 'Show version') do
    puts "octodown v#{Octodown::VERSION}"
    exit
  end

  opts.on(
    '-s', '--style [STYLE]', [:github, :atom], 'Choose style (atom, github)'
  ) do |s|
    options[:style] = s
  end

  opts.on(
    '-p', '--pdf', 'Generates a pdf file'
  ) do
    options[:presenter] = :pdf
  end

  opts.on('-r', '--[no-]raw', 'Print raw HTML to STDOUT') do
    options[:presenter] = :raw
  end

  opts.on('-g', '--[no-]gfm', 'Use for non-README files (comments, etc)') do |g|
    options[:gfm] = g
  end

  opts.on('-S', '--server', 'Start a web server') do
    options[:presenter] = :server
  end

  opts.on('-P', '--port [PORT]', 'Server port (default: ' \
          "#{Octodown::Renderer::Server::DEFAULT_PORT})") do |port|
    options[:server] = true
    options[:port] = port.to_i
  end

  opts.on_tail('-h', '--help', 'Show this message') do
    puts opts
    exit
  end
end.parse!

Octodown.call options
